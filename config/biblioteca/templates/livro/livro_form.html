<!-- biblioteca/templates/livro/livro_form.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Adicionar Livro - BookStack{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/livro_form.css' %}" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
{% endblock %}

{% block content %}

<div class="page-wrapper">

  <header class="top-header">
    <a href="{% url 'home' %}" class="back-btn">←</a>
    <h1 class="titulo">Adicionar Novo Livro</h1>
  </header>

  <div class="container">

    <form class="form" method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-group full">
        <label for="{{ form.capa.id_for_label }}">Capa do Livro</label>
        {{ form.capa }}
        {% if form.capa.errors %}
          <div class="error">{{ form.capa.errors }}</div>
        {% endif %}
        <small class="form-text">JPG, PNG ou GIF • Máx. 5MB</small>
      </div>

      <div class="form-group">
        <label>Título</label>
        {{ form.titulo }}
      </div>

      <div class="form-group">
        <label>Editora</label>
        {{ form.editora }}
      </div>

      <div class="form-group">
        <label>ISBN</label>
        {{ form.isbn }}
      </div>

      <div class="form-group">
        <label>Status</label>
        {{ form.status }}
      </div>

      <div class="form-group">
        <label>Ano de Publicação</label>
        {{ form.ano_publicacao }}
      </div>

      <div class="form-group">
        <label>Autores</label>
        {{ form.autores }}
      </div>

      <div class="form-group full">
        <label>Categorias</label>
        {{ form.categorias }}
      </div>

      <div class="btn-area full">
        <button type="submit" class="btn-add">Salvar Livro</button>
      </div>
    </form>
  </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close" onclick="fecharPopup()">×</button>
    <h2>Livro salvo com sucesso ✔️</h2>
    <p>ID: <span id="popup-id"></span></p>
    <p>Nome: <span id="popup-nome"></span></p>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  function abrirPopup(id, nome) {
    document.getElementById("popup-id").innerText = id;
    document.getElementById("popup-nome").innerText = nome;
    document.getElementById("popup").classList.remove("hidden");
  }

  function fecharPopup() {
    document.getElementById("popup").classList.add("hidden");
  }

  $(document).ready(function () {
    $(".multi-select").select2({
      placeholder: "Selecione...",
      width: "100%",
    });
  });
</script>

{% if request.GET.sucesso %}
<script>
  abrirPopup("{{ request.GET.livro_id }}", "{{ request.GET.livro_nome }}");
</script>
{% endif %}

{% endblock %}
